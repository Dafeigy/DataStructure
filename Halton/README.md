## 说在前面

在之前的蒙特卡洛方法中，我们将其应用在求复杂曲线的积分、平面图形的面积等问题上。我们也发现了，蒙特卡洛方法的计算往往需要大量的采样点才能得到较为准确的结果，而拟蒙特卡洛方法作为蒙特卡洛方法的一种改进，能在较低的采样数下就能获得与真实值相近的结果。拟蒙特卡洛方法的主要改进点，就是在更换了蒙特卡洛方法中的随机采样，将随机采样点更换为一种低差异序列进行采样。

## 低差异序列是什么

低差异序列相比于蒙特卡洛使用的伪随机，它兼顾了“均匀”和“随机”两方面，一个直观的例子如图所示。Low Discrepancy Sequence，其中的这个Discrepancy的定义是这样的：
$$
D_N(P)=sup_{B\in J}|\frac{A(B)}{N}-\lambda _s (B)|
$$
简单来说就是，对于一个在$[0,1]^n$的空间点集，任选一个空间中的区域$B$，此区域内点的数量$A$和点集个数的总量$N$的比值和此区域的体积$\lambda_s$的差的绝对值的最大值。分布越均匀的点集，任意区域的点集数量占点总数量的比例也会越趋近这个区域的体积。

## 如何产生一个低差异序列

在讲如何产生低差异序列之前，需要先介绍一种运算：Raidical inversion。

假设b是一个正整数，则任何一个整数i如果先将i表示成b进制的数，然后把得到的数中的每一个位上的数字al(i)排成一个向量，和一个生成矩阵（generator matrix）C相乘得到一个新的向量，最后再把这个新向量中镜像到小数点右边去就能得到这个数以b为底数，以C为生成矩阵的radical inversion$\phi_{b,C(i)}$。

当这个生成矩阵$C$是单位矩阵的时候，我们就可以得到Van  der Corput序列的定义式。Van der Corput序列是由荷兰数学家范德科皮特在1935年首次描述的。Van der Corput就是低差异序列中的一种，下面进一步介绍的Halton序列就是Vander Corput的高阶形式。

## Halton序列的生成

以二维空间为例。Halton序列是以质数为基进行构造的，我们把第一个基设为2，另一个基设为3。对于第一个基，首先将区间$[0,1]$分成两部分，即$(0,1/2)$和$(1/2,1)$，然后继续进行分割，得到：
$$
\frac{1}{2},\frac{1}{4},\frac{3}{4},\frac{1}{8},\frac{3}{8},\frac{7}{8},
\dots
$$
Halton序列的第n个数字是用二进制表示的数字n，倒过来，并写在小数点之后，也就是radical inversion的过程，这对任何基数都是如此。比如说以2为底的基的第六个元素，6表示为110，将其反转，变成0.011，对应的就是3/8.对于另一个基，也是这么操作，然后将两个序列中相同索引的元素取出组成向量，即可得到n维的Halton序列。

在采样点为1000和3000的时候在二维情况下进行对比：

![](https://s2.loli.net/2022/12/21/dzIaTuLibSwnyk8.png)

## 不足之处与改进

`Halton`序列的一个缺点是，在用一些比较大的质数作为底数时，序列的分布在点的数量不那么多的时候并不会均匀的分布，只有当点的数量接近底数的幂的时候分布才会逐渐均匀。下面给出了取29，31作为底时的生成情况。一开始这些点会分布在$1/29,2/29,3/29,\dots$上面没所以会成为直线的趋势，解决的方法就是使用Scrambling。一般使用的是Faure Scrambling，定义如下：
$$
\Phi_b(i=\sum_{l=0}^{M-1}\sigma_b(a_l(i))b^{-l-1}
$$
它就是在做radical inverse 的时候不直接将数字镜像到小数点右边，而是在镜像前先把每个数字经过一个`permutation`$\sigma_b$转换成另一个数字，这个转换是有一套公式计算的，由于不是本文的重点故不在这过多赘述。 这里值得一提的时`Scrambling`完全不会影响`radical inversion`序列分布的随机性，因为`radical inversion`会自然的将空间均等划分成底数bb的整数次幂个部分，`scrambling`本质上就是在交换这些均等划分的部分，所以`Scrambled`后的序列依然具有`radical inversion`的性质。

![img](https://s2.loli.net/2022/12/21/wPDUtu6Sd9YIg4A.png)

## Reference

1. [Halton sequence - Wikipedia](https://en.wikipedia.org/wiki/Halton_sequence)

2. [低差异序列（一）- 常见序列的定义及性质 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/20197323?columnSlug=graphics)